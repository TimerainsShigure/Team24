import{x as K,E as J}from"./el-input-B8xNxJve.js";import{a as O}from"./el-overlay--8Z_-jd2.js";import{c as P,E as T}from"./el-form-item-DFJaNJEN.js";import{d as Q,g as W,e as X,f as R,h as Y}from"./index-CMI59eta.js";import{E as L}from"./index-Ca6jGdRA.js";import{r as a,E as Z,G as z,o as g,f as N,h as u,j as t,I as p,y as x,_ as ee,H as te,p as E,A as F,z as n,l as M,F as se,a5 as le,C as A,a4 as oe,J as ae,K as ne,L as ie}from"./index-DDUTDMAD.js";import{f as q}from"./parseGet-BuM69Yjo.js";import"./scroll-CLntsgrV.js";const ce={class:"dialog-footer"},ue={__name:"commit",props:{blogId:{type:[String,Number]}},emits:["close","flush"],setup(f,{emit:y}){const S=a(!0),C=y,I=f,{blogId:e}=Z(I),r=z({comment:""}),_=a(!1),w=z({comment:[{required:!0,trigger:"change"}]}),B=a(null),V=d=>{d.validate().then(()=>{_.value=!0;let o={content:r.comment,u_id:localStorage.getItem("uid"),blog_id:e.value};Q(o).then(v=>{C("close"),L.success({message:"add success",type:"success"}),C("flush")}).finally(()=>{_.value=!1})})},D=()=>{C("close")};return(d,o)=>{const v=K,h=P,$=T,k=J,j=O;return g(),N(j,{"before-close":D,modelValue:S.value,"onUpdate:modelValue":o[2]||(o[2]=m=>S.value=m),title:"Comment",width:"500","align-center":!0,center:""},{footer:u(()=>[t("div",ce,[p(k,{onClick:D},{default:u(()=>[x("Cancel")]),_:1}),p(k,{loading:_.value,type:"primary",onClick:o[1]||(o[1]=m=>V(B.value))},{default:u(()=>[x(" Confirm ")]),_:1},8,["loading"])])]),default:u(()=>[p($,{"label-width":80,rules:w,ref_key:"ruleFormRef",ref:B,model:r},{default:u(()=>[p(h,{label:"comment",prop:"comment"},{default:u(()=>[p(v,{modelValue:r.comment,"onUpdate:modelValue":o[0]||(o[0]=m=>r.comment=m),type:"textarea",rows:"5",placeholder:"Please enter your comment"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])}}},b=f=>(ae("data-v-6e3c3fc8"),f=f(),ne(),f),re={class:"container"},de={key:0,class:"deleteBlog"},me=b(()=>t("div",{style:{"margin-right":"5px","font-size":"20px"}},"close",-1)),_e=b(()=>t("div",{class:"iconfont icon-close"},null,-1)),ve=[me,_e],ge={class:"post-image"},pe=["src"],fe={class:"post-details"},he={class:"user-info"},ke=["src"],be={class:"id"},ye={class:"title"},Se={class:"text"},Ce={class:"published-date"},Ie=b(()=>t("hr",null,null,-1)),xe={class:"comment-count"},we={class:"comments-section"},Be=["src"],De={class:"comment-content"},Ee={class:"comment-id"},Ve={class:"comment-text"},$e={class:"comment-date"},je={class:"interaction-bar"},Fe={class:"actions"},Le={style:{"margin-left":"5px",color:"black"}},Ne=b(()=>t("div",null,"Like",-1)),Re={style:{"margin-left":"5px",color:"black"}},ze=b(()=>t("div",null,"save",-1)),Me={class:"iconfont icon-pinglun",style:{display:"flex","align-items":"center"}},Ae={style:{"margin-left":"5px",cursor:"pointer"}},qe=b(()=>t("div",null,"comments",-1)),Je={__name:"card-detail",setup(f){const y=a(!1),S=ie(),C=oe(),I=a("http://127.0.0.1:8001"),e=a(JSON.parse(C.query.item)),r=a([]);function _(l){let s=e.value.blog_id;W(`?blog_id=${s}`).then(i=>{r.value=i}),l&&(e.value.comments=e.value.comments+1)}_();const w=a(!1);te(()=>{w.value=localStorage.getItem("isSuper")==="true"||localStorage.getItem("uid")===String(e.value.u_id)});function B(l){return localStorage.getItem("isSuper")==="true"||localStorage.getItem("uid")===String(l)}function V(){X(`${e.value.blog_id}`).then(()=>{L.success({message:"delete blog success",type:"success"}),S.back()})}function D(l){let s=e.value.blog_id;Y(`${l}/?blog_id=${s}`).then(()=>{L.success({message:"delete comments success",type:"success"}),e.value.comments=e.value.comments-1,_()})}const d=a(!1),o=a(!1);let v=e.value.likes_user,h=e.value.favorite_user;function $(){let l=localStorage.getItem("uid");v&&(v=v.split(","),d.value=v.some(s=>s===l)),h&&(h=h.split(","),o.value=h.some(s=>s===l))}$();const k=a(!1);function j(){if(k.value)return;k.value=!0;let l={u_id:e.value.u_id,likes:"",likes_user:""},s=e.value.likes_user;s?s=String(s).split(","):s=[],d.value?(e.value.likes=e.value.likes-1,l.likes_user=s.filter(i=>i!==String(localStorage.getItem("uid"))).join(",")||null):(e.value.likes=e.value.likes-1+2,s.push(localStorage.getItem("uid")),l.likes_user=s.join(",")),l.likes=e.value.likes,R(e.value.blog_id,l).then(()=>{d.value=!d.value,k.value=!1})}const m=a(!1);function U(){if(m.value)return;m.value=!0;let l={u_id:e.value.u_id,views:"",favorite_user:""},s=e.value.favorite_user;s?s=String(s).split(","):s=[],o.value?(e.value.views=e.value.views-1,l.favorite_user=s.filter(i=>i!==String(localStorage.getItem("uid"))).join(",")||null):(e.value.views=e.value.views-1+2,s.push(localStorage.getItem("uid")),l.favorite_user=s.join(",")),l.views=e.value.views,R(e.value.blog_id,l).then(()=>{o.value=!o.value,m.value=!1})}const G=()=>{S.back()};return(l,s)=>{const i=J;return g(),E("div",re,[w.value?(g(),E("div",de,[p(i,{size:"large",style:{width:"100px"},type:"danger",onClick:V},{default:u(()=>[x("DeleteBlog")]),_:1})])):F("",!0),t("div",{class:"close",onClick:G},ve),t("div",ge,[t("img",{src:I.value+e.value.image,style:{height:"100%",width:"100%","border-radius":"8px"},alt:"帖子图片"},null,8,pe)]),t("div",fe,[t("div",he,[t("img",{src:I.value+e.value.avatar,alt:"用户头像",class:"avatar"},null,8,ke),t("span",be,n(e.value.u_name),1)]),t("h1",ye,n(e.value.title),1),t("p",Se,n(e.value.content),1),t("span",Ce,"Date:"+n(M(q)(new Date(e.value.created_time))),1),Ie,t("span",xe,"Comments："+n(r.value.length),1),t("div",we,[(g(!0),E(se,null,le(r.value,(c,H)=>(g(),E("div",{class:"comment",key:H},[t("img",{src:I.value+c.avatar,alt:"评论者头像",class:"avatar comment-avatar"},null,8,Be),t("div",De,[t("span",Ee,[t("span",null,"Commenter ID："+n(c.u_name),1),t("span",null,[B(c.u_id)?(g(),N(i,{key:0,onClick:Ue=>D(c.c_id),type:"danger"},{default:u(()=>[x("Delete")]),_:2},1032,["onClick"])):F("",!0)])]),t("p",Ve,"Content："+n(c.content),1),t("span",$e,"Date:"+n(M(q)(new Date(c.created_time))),1)])]))),128))]),t("div",je,[p(i,{type:"danger",class:"comment-button",onClick:s[0]||(s[0]=c=>y.value=!0)},{default:u(()=>[x("click to commit")]),_:1}),t("div",Fe,[t("div",null,[t("div",{class:"iconfont icon-xihuan",style:A([{color:d.value?"red":"black"},{display:"flex","align-items":"center",cursor:"pointer"}]),onClick:j},[t("span",Le,n(e.value.likes),1)],4),Ne]),t("div",null,[t("div",{class:"iconfont icon-shoucang",style:A([{color:o.value?"yellow":"black"},{display:"flex","align-items":"center",cursor:"pointer"}]),onClick:U},[t("span",Re,n(e.value.views),1)],4),ze]),t("div",null,[t("div",Me,[t("span",Ae,n(e.value.comments),1)]),qe])])]),y.value?(g(),N(ue,{key:0,onClose:s[1]||(s[1]=c=>y.value=!1),blogId:e.value.blog_id,onFlush:s[2]||(s[2]=c=>_(!0))},null,8,["blogId"])):F("",!0)])])}}},Xe=ee(Je,[["__scopeId","data-v-6e3c3fc8"]]);export{Xe as default};
